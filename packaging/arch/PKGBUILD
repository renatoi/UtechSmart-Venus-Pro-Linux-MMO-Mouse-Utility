# Maintainer: Es00bac <es00bac@example.com>
pkgname=venus-pro-linux
pkgver=0.3.0
pkgrel=1
pkgdesc="Configuration utility for UtechSmart Venus Pro / Venus MMO Mouse (Linux)"
arch=('any')
url="https://github.com/Es00bac/UtechSmart-Venus-Pro-Linux-MMO-Mouse-Utility"
license=('MIT')
depends=('python' 'python-pyqt6' 'python-hidapi' 'hidapi')
optdepends=('python-evdev: macro playback support'
            'python-pyusb: magic unlock for macro pages')
makedepends=()
source=()
md5sums=()

# Build from the local git checkout (parent of packaging/arch/)
_srcdir="$(cd "$(dirname "${BASH_SOURCE[0]}")/../.." && pwd)"

package() {
    cd "${_srcdir}"

    # 1. Install Python modules and assets to /opt/venusprolinux
    install -d "${pkgdir}/opt/${pkgname}"
    install -m644 venus_gui.py venus_protocol.py holtek_protocol.py \
                  device_driver.py staging_manager.py transaction_controller.py \
                  mouseimg.png icon.png \
                  "${pkgdir}/opt/${pkgname}/"

    # 2. Launcher script
    install -d "${pkgdir}/usr/bin"
    cat > "${pkgdir}/usr/bin/venusprolinux" <<'LAUNCHER'
#!/bin/sh
exec python3 /opt/venus-pro-linux/venus_gui.py "$@"
LAUNCHER
    chmod 755 "${pkgdir}/usr/bin/venusprolinux"

    # 3. Desktop entry
    install -Dm644 packaging/linux/venusprolinux.desktop \
        "${pkgdir}/usr/share/applications/venusprolinux.desktop"

    # 4. Icon
    install -Dm644 icon.png \
        "${pkgdir}/usr/share/pixmaps/venusprolinux.png"

    # 5. Udev rules
    install -Dm644 packaging/linux/99-venus-pro.rules \
        "${pkgdir}/usr/lib/udev/rules.d/99-venus-pro.rules"

    # 6. License
    install -Dm644 LICENSE \
        "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}
